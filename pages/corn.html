Corn is a small<a href="#well-sorta"><sup>*</sup></a>, command line-friendly
music playing daemon.  It strikes a balance between command line flexibility
and desktop integration.

Key features:

<ul>
    <li>Uses libxine for playback -- supports the many file formats that xine does.</li>
    <li>Uses GConf for saving settings.</li>
    <li>Uses D-BUS and the <a
        href="http://mpris.org/">MPRIS</a> standard for
        inter-process communication.</li>
    <li>Scriptable via any language with D-BUS bindings, or via <a
        href="mpris-remote.html">mpris-remote</a> on the command line.</li>
    <li>Roughly 2000 lines of C.</li>
</ul>

Code is at <a href="http://github.com/mackstann/corn/tree/master">github</a>.

<pre class="sh"><code>git clone git://github.com/mackstann/corn.git
cd corn
./autogen.sh
./configure
make

./corn/corn &amp;

# or

make install
corn &amp;</code></pre>

<h3>build dependencies</h3>

You'll need to <code>apt-get build-dep quark</code> and then also install the
<code>libdbus-glib-1-2</code> and <code>libdbus-glib-1-dev</code> packages.  Or
on non-apt systems, you'll need GNU autotools, dbus-glib, libxine, glib, gconf,
gnome-vfs, and gthread.

Real tarballs will be up... sometime.

Corn is a fork of <a href="http://quark.sunsite.dk/">Quark</a>.

<h3>scripting examples</h3>

<pre class="sh"><code>#!/bin/sh
mpris-remote clear
mpris-remote random true
mpris-remote loop true
find ~/music -name '*.mp3' | mpris-remote addtrack -
mpris-remote play</code></pre>

<pre class="python"><code>#!/usr/bin/env python
import dbus

bus = dbus.SessionBus()

player = dbus.Interface(bus.get_object('org.mpris.corn', '/Player'),
                        dbus_interface='org.freedesktop.MediaPlayer')

player.Next()

print 'volume:', player.VolumeGet()
for pair in sorted(player.GetMetadata().items()):
    print "%-18s: %s" % pair</code></pre>

<h3>don't have a dbus session bus running?</h3>

If you use <code>startx</code> with a smaller window manager instead of a full
blown desktop environment, you may not have a dbus session bus running.  The
system bus (<code>dbus-daemon --system</code> in your <code>ps</code> output)
will not do -- it is not for communication between user apps.  To get a session
bus running, put this in your .xinitrc:

<pre class="sh"><code>if test -z "$DBUS_SESSION_BUS_ADDRESS" ; then
    eval `dbus-launch --sh-syntax --exit-with-session`
fi</code></pre>

<h3>selecting an audio driver</h3>

For me, libxine by default tries to connect to a pulse audio daemon with a timeout,
which caused a startup delay for corn.  But corn has its own xine config file,
which is at <code>~/.corn/xine_config</code>.  You can just symlink it to
<code>~/.xine/config</code> if you want corn to use the same libxine settings
as the xine program, or it can be its own separate file.  Here is my
<code>xine_config</code>:

<pre><code>audio.driver:alsa
engine.decoder_priorities.mad:1000</code></pre>

<h3><a name="well-sorta">well, depends on what you mean by small</a></h3>

Corn actually uses kind of a lot of memory right now (60-80MB for me).  This is
a libxine problem, apparently due to it <a
    href="http://paul-pach.blogspot.com/2008/03/finding-bloat-in-kde4.html?showComment=1208382840000#c4871031230157608326">allocating
    tons of unnecessary buffers</a>.  Supposedly it will be fixed sometime.
But even until then -- hey -- 80MB is only about 4% of 2GB!

What I really care about when it comes to smallness is the size and complexity
of the code.

